from analyze.models import Files
from django.core.files.storage import default_storage
from django.db.models import Q
import logging
import traceback



#remove files which existed longer than a day
def remove_long_existed_files():
    try:
        objects = Files.objects.filter(Q(yara_scanner_status="FINISHED") | Q(yara_scanner_status="FAILED"), Q(clamav_scanner_status="FINISHED") | Q(clamav_scanner_status="FAILED"), Q(antiviruses_scanner_status="FINISHED") | Q(antiviruses_scanner_status="FAILED"))
        for obj in objects:
            file_field = obj.file
            file_path = file_field.path
            default_storage.delete(file_path)
    except:
        logging.error(traceback.format_exc())
