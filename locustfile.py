from locust import HttpUser, task, between
import base64
import logging
import traceback
import json

class ScanTest(HttpUser):
    wait_time = between(1, 50)
    @task
    def scan_file_test(self):
        file_path = "/home/mohammadjavad/Desktop/sanad/2006.02801.pdf"
        with open(file_path, "rb") as file:
            files = {"file": ('eivazi_cv.pdf',file,"application/pdf")}
            data = {
                'transmission_type': "upload"
            }
            username =  "radmehr.h@test1.local"
            password = "qqqqqq1!"
            headers = {
                "Authorization": f"Basic {base64.b64encode(f'{username}:{password}'.encode()).decode()}",
            }
            response = self.client.post("/analyze/scan/", files=files, data=data, headers=headers)
            if response.status_code == 200:
                print("file uploaded successfully")
            else:
                print(response)
                logging.error(traceback.format_exc())
                print("file upload failed")