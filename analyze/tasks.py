import sys
from malware_analysis.celery import app
from utils.functions import remove_long_existed_files
from celery import shared_task
from malware_analysis.settings import BASE_DIR
from analyze.models import Files
sys.path.append(BASE_DIR)
from clients.yara import YaraClient
from clients.clamav import ClamAvClient
from clients.virustotal import VirusTotalClient
import logging
import traceback

@shared_task()
def scan_files_task(obj_pk, file):
    try:
        yara_client = YaraClient()
        clamav_client = ClamAvClient()
        virustotal_client = VirusTotalClient()
        virustotal_client.get_file_report_by_hash(obj_pk, file)
        yara_client.scanning_files(obj_pk, file)
        clamav_client.scan_file(obj_pk, file)
        virustotal_client.get_file_report_by_hash(obj_pk, file)
    except:
        logging.error(traceback.format_exc())

@app.task
def periodic_remove_long_existed_files():
    remove_long_existed_files()




    




