from rest_framework.serializers import ModelSerializer
from rest_framework import serializers
from analyze.models import Files
from zipfile import ZipFile
import magic


class FileSerializers(ModelSerializer):

    class Meta:
        model = Files
        fields = "__all__"

    def validate_file(self, value):
        file_type =  magic.from_buffer(value.read(), mime=True)
        if file_type == "application/zip":
            zip_file = ZipFile(value)
            file_list = zip_file.filelist
            for _ in file_list:
                file_name = _.filename
                if _.compress_size != 0:
                    file = file_name
                    break
                else:
                    pass
            try:
                zip_file.open(file)
            except Exception as e:
                raise serializers.ValidationError(e)
        # elif file_type == "application/pdf":
        #     raise serializers.ValidationError("you are not trusted to upload this file type")
        else:
            return value


